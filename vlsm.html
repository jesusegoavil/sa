<!DOCTYPE html>
<html lang="es">
<head>
<meta charset="UTF-8">
<title>Calculadora VLSM</title>
<meta name="viewport" content="width=device-width, initial-scale=1.0">

<style>
/* === CSS ORIGINAL (SIN CAMBIOS) === */
*{margin:0;padding:0;box-sizing:border-box}
body{
font-family:"Times New Roman",serif;
background:linear-gradient(135deg,#ff9a9e,#fad0c4,#a18cd1,#fbc2eb,#96e6a1);
background-size:500% 500%;
animation:fondoAnimado 12s ease infinite;
padding:20px;
min-height:100vh
}
@keyframes fondoAnimado{
0%{background-position:0% 50%}
50%{background-position:100% 50%}
100%{background-position:0% 50%}
}
.container{max-width:1200px;margin:0 auto}
.header{
display:flex;justify-content:space-between;align-items:center;
background:white;padding:20px;border-radius:15px;
margin-bottom:20px;box-shadow:0 8px 30px rgba(0,0,0,.2)
}
.card{
background:white;padding:25px;margin-bottom:20px;border-radius:15px;
box-shadow:0 8px 30px rgba(0,0,0,.2)
}
.input-group{
display:grid;grid-template-columns:2fr 1fr 1fr;gap:12px
}
.subredes-container{
display:grid;grid-template-columns:repeat(auto-fill,minmax(200px,1fr));
gap:12px;margin:20px 0
}
.subred-input-group label{font-weight:bold}
table{width:100%;border-collapse:collapse;margin-top:20px}
th,td{border:2px solid #333;padding:10px;text-align:center;font-weight:bold}
</style>
</head>

<body>

<div class="container">

<div class="header">
<h2>Calculadora VLSM</h2>
<button onclick="volverInicio()">← Volver</button>
</div>

<div class="card">
<div class="input-group">
<input type="text" id="ipBase" placeholder="IP base (192.168.1.0)">
<input type="number" id="prefijoBase" placeholder="Prefijo (24)">
<input type="number" id="numSubredes" placeholder="Subredes">
</div>
<button onclick="crearInputs()">Crear Campos</button>
</div>

<div id="subredesContainer" class="subredes-container"></div>

<div class="card" id="btnCalcularCard" style="display:none">
<button onclick="calcularVLSM()">Calcular VLSM</button>
</div>

<div class="card" id="resultadosCard" style="display:none">
<h3>Resultados</h3>

<table id="tablaVLSM">
<thead>
<tr>
<th>SR</th>
<th>Hosts necesarios</th>
<th>Hosts encontrados</th>
<th>Hosts disponibles</th>
<th>Prefijo</th>
<th>Red</th>
<th>Máscara</th>
<th>Primera IP</th>
<th>Última IP</th>
<th>Broadcast</th>
</tr>
</thead>
<tbody></tbody>
</table>
</div>

</div>

<script>
function ipToNumber(ip){
return ip.split('.').reduce((a,o)=>a*256+parseInt(o),0);
}

function numberToIp(num){
return [24,16,8,0].map(s=>(num>>s)&255).join('.');
}

function validarIP(ip){
return /^(\d{1,3}\.){3}\d{1,3}$/.test(ip) &&
ip.split('.').every(o=>o>=0 && o<=255);
}

function calcularMascara(prefijo){
let mask = 0xffffffff << (32 - prefijo);
return [24,16,8,0].map(s => (mask >> s) & 255).join('.');
}

function crearInputs(){
const n=parseInt(numSubredes.value);
if(!n || n<1) return alert("Cantidad de subredes inválida");

subredesContainer.innerHTML="";
for(let i=1;i<=n;i++){
subredesContainer.innerHTML+=`
<div class="subred-input-group">
<label>Subred ${i}</label>
<input type="number" id="hosts${i}" min="1" placeholder="Hosts">
</div>`;
}
btnCalcularCard.style.display="block";
}

function calcularVLSM(){
const ip=ipBase.value.trim();
const prefijoBaseNum=parseInt(prefijoBase.value);
const n=parseInt(numSubredes.value);

if(!validarIP(ip)) return alert("IP base inválida");
if(prefijoBaseNum<1 || prefijoBaseNum>30) return alert("Prefijo inválido");

let datos=[];
for(let i=1;i<=n;i++){
let h=parseInt(document.getElementById(`hosts${i}`).value);
if(!h || h<1) return alert("Hosts inválidos");
datos.push(h);
}

datos.sort((a,b)=>b-a);

let redNum = ipToNumber(ip);
let limiteRed = redNum + 2**(32-prefijoBaseNum);
let tbody=document.querySelector("#tablaVLSM tbody");
tbody.innerHTML="";

datos.forEach((h,i)=>{
let bits=Math.ceil(Math.log2(h+2));
let total=2**bits;
let encontrados=total-2;
let disponibles=encontrados-h;
let prefijo=32-bits;

if(redNum + total > limiteRed){
alert("Las subredes exceden el rango de la red base");
throw new Error("Rango excedido");
}

tbody.innerHTML+=`
<tr>
<td>${i+1}</td>
<td>${h}</td>
<td>${encontrados}</td>
<td>${disponibles}</td>
<td>/${prefijo}</td>
<td>${numberToIp(redNum)}</td>
<td>${calcularMascara(prefijo)}</td>
<td>${numberToIp(redNum+1)}</td>
<td>${numberToIp(redNum+total-2)}</td>
<td>${numberToIp(redNum+total-1)}</td>
</tr>`;

redNum += total;
});

resultadosCard.style.display="block";
}

function volverInicio(){
location.href="bienvenido.html";
}
</script>

</body>
</html>
